<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="utf8">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script>
            $(document).ready(function(){
				
				$("#programForm").submit(function(event) {
					event.preventDefault();
					var programId = $("li.selected").val();

					$.ajax({
						type: "POST",
						url: "setProgram.php",
						data: {programId: programId},
						dataType: 'html',
						success: function(html) {
							if(html) {
								document.location.href = "";
							} else {
								alert("Invalid degree program selection");
							}
						}
					});
				});

				var xhr = new XMLHttpRequest();
				xhr.addEventListener("load", degreeHandler);
				xhr.open("GET", "degreePrograms.php");
				xhr.send();

            });
            
			function degreeHandler() {
				var degreePrograms = JSON.parse(this.response);
				for(var degreeName in degreePrograms) {
					$("#degreePrograms").append($("<li>", {
						value: degreeName,
						text: degreeName
					}));

					var degreeOptions = $("<ul id='sublist'>");
					for(var degreeOption in degreePrograms[degreeName].option) {
						degreeOptions.append($("<li>", {
							value: degreeOption,
							text: degreeOption
						}));
					}
					$("#degreePrograms").append(degreeOptions);
				}
				$("#sublist").click(function(event) {
					if(event.target.tagName === "LI") {
						var selected = $("li.selected");
						if(selected) {
							selected.removeClass("selected");
						}
						event.target.className = "selected";
					}
				});
			}
        </script>
    </head>
    <body>
		<form id="programForm" action="setProgram.php" method="POST">
			<div>
				<ul id="degreePrograms">

				</ul>
			</div>
		</form>
    </body>
</html>
