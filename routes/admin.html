<!DOCTYPE html>
<html>
	<link rel="stylesheet" type="text/css" href="../styles/popup.css">
    <head>
        <meta charset="utf8">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script>
			var catalogRule;
			var catalogs;
			var $catalogs = {};
			var $objectSubjects = {};
			var catalogsLoaded = 0;
			var catalogNames = [];
			var requiredCourseIds; // This is an array initialized at the start of every modify popup
			var minors;
			var $minorsSubjectSelect = {};
			var selectedMinors = [];
			var certificates;
			var $certificatesSubjectSelect = {};
			var selectedCertificates = [];
			var selectedOverrides = [];
			var selectedCatalogs = [];
			var addCourse = [];
			var removeCourse = [];
			var objectsParam = [];
			var degreeProgramIds = [];
			
			$(document).ready(function(){			
				var xhr = new XMLHttpRequest();
				xhr.addEventListener("load", degreeHandlerInit);
				xhr.open("GET", "../scripts/degreePrograms.php");
				xhr.send();
				
				$("#deleteForm").click(function() {
					if(confirm("Are you sure you want to delete this program? Press OK to delete")) {
						$.ajax({
							type: "POST",
							url: "../scripts/deleteObject.php",
							data: {idObject : $(this).attr("idobjects") },
							//dataType: "json",
							success: function(json) {
								location.reload();
							},
							error: function(xhr, ajaxOptions, thrownError) {
								console.log(thrownError);
							}
						});
					} 
				});
				
				$("#addNewItemButton").click(function() {
					console.log("Inside the button");
					var data = {};
					if($("#objectSubjects option:selected").val() === "newSubject") {
						data["subject"] = $("#newObjectSubject").val();
						if(data["subject"] === "") {
							alert("Subject name is required");
							return false;
						}
					} else {
						data["subject"] = $("#objectSubjects option:selected").val();
					}
					data["typeName"] = $("#newItemCategories option:selected").val();
					data["name"] = $("#newItemName").val();
					if(data["name"] === "") {
						alert("Name is required");
						return false;
					}
					console.log(data);
					$.ajax({
						type: "POST",
						url: "../scripts/addNewObject.php",
						data: data,
						//dataType: "json",
						success: function(json) {
							location.reload();
						},
						error: function(xhr, ajaxOptions, thrownError) {
							console.log(thrownError);
						}
					});
				});
				
				$("#catalogList").change(function(){
					$("#classListLabel + select").detach();
					$catalogs[$(this).val()].clone().insertAfter($("#classListLabel"));
				});
				
				$("#catalogListOverrides").change(function(){
					$("#classListLabelOverrides + select").detach();
					$catalogs[$(this).val()].clone().insertAfter($("#classListLabelOverrides"));
				});
				
				$("#minorSubjectList").change(function(){
					$("#minorSelect").detach();
					$minorsSubjectSelect[$(this).val()].insertAfter($("#minorSelectLabel"));
				});
				
				$("#newItemCategories").change(function(){
					$("#objectSubjects").detach();
					$objectSubjects[$(this).val()].insertAfter($("#objectSubjectLabel"));
					if($("#objectSubects option:selected").val() === "newSubject") {
						$("#newObjectSubjectSpan").show();
					} else {
						$("#newObjectSubjectSpan").hide();
					}
				});
				
				$("#addClassButtonOverrides").click(function(){
					var courseId = $("#overridesContainer > #courseList option:selected").val();
					if(!courseId) {
						return false;
					}
					console.log(selectedOverrides);
					if(!selectedOverrides.includes(courseId)) {
						selectedOverrides.push(courseId);
						var courseOverrideInfo = {};
						courseOverrideInfo.maxCount = 1;
						courseOverrideInfo.minGrade = catalogRule["Degree Program"].minGrade;
						courseOverrideInfo.minHours = catalogs[courseId].lowHours;
						courseOverrideInfo.maxHours = catalogs[courseId].highHours;
						attachCourseOverrideEntry(courseId, courseOverrideInfo);
					}
				});
				
				$("#addCatalogButton").click(function() {
					var catalogName = $("#applicableCatalogsSelect option:selected").val();
					if(!selectedCatalogs.includes(catalogName)) {
						selectedCatalogs.push(catalogName);
						$.ajax({
							type: "POST",
							url: "../scripts/courseCatalog.php",
							data: {catalogName : catalogName},
							dataType: "json",
							success: function(json) {
								addNewCatalog(json, catalogName);
							},
							error: function(xhr, ajaxOptions, thrownError) {
								console.log(thrownError);
							}
						});
					}
				});
				
				//TODO modularize these click events into one
				$("#addClassButton").click(function(){
					var courseId = $("#courseList option:selected").val();
					if(!requiredCourseIds.includes(courseId)) {
						requiredCourseIds.push(courseId);
						var $removeButton = $("<input>", {
							id: courseId,
							type: "submit",
							name: "removeClassButton",
							value: "Remove"
						});
						$removeButton.click(removeRequiredHandler);
						$("#classsublist").append($("<li>",{
							text: catalogs[courseId].name
						}).append($removeButton));
					}
				});
				
				$("#addMinorButton").click(function(){
					var minorId = parseInt($("#minorSelect option:selected").val());
					if(!selectedMinors.includes(minorId)) {
						selectedMinors.push(minorId);
						var $removeButton = $("<input>", {
							id: minorId,
							type: "submit",
							name: "removeClassButton",
							value: "Remove"
						});
						$removeButton.click(removeMinorHandler);
						$("#minorList").append($("<li>",{
							text: minors[minorId].name
						}).append($removeButton));
					}
				});
				
				$("#addCertificateButton").click(function(){
					var certificateId = parseInt($("#certificateSelect option:selected").val());
					if(!selectedCertificates.includes(certificateId)) {
						selectedCertificates.push(certificateId);
						var $removeButton = $("<input>", {
							id: certificateId,
							type: "submit",
							name: "removeClassButton",
							value: "Remove"
						});
						$removeButton.click(removeCertificateHandler);
						$("#certificateList").append($("<li>",{
							text: certificates[certificateId].name
						}).append($removeButton));
					}
				});

				$("#saveForm").click(function(){
					var catalogFormChange = {Hrs400Min: false, Hrs400Max: false, Hrs500Min: false, Hrs500Max: false, Hrs600Min: false, Hrs600Max:false}
					var catalogFormObj = {
						requiredHrs:$("#requiredHrs").val(),
						Hrs400Min: $("#400HrsMin").val(),
						Hrs400MinOptionFixed: $("#400HrsMinOptionFixed").is(":checked"),
						Hrs400MinOptionVariable: $("#400HrsMinOptionVariable").is(":checked"),
						Hrs400Max: $("#400HrsMax").val(),
						Hrs400MaxOptionFixed: $("#400HrsMaxOptionFixed").is(":checked"),
						Hrs400MaxOptionVariable: $("#400HrsMaxOptionVariable").is(":checked"),
				
						Hrs500Min: $("#500HrsMin").val(),
						Hrs500MinOptionFixed: $("#500HrsMinOptionFixed").is(":checked"),
						Hrs500MinOptionVariable: $("#500HrsMinOptionVariable").is(":checked"),
						Hrs500Max: $("#500HrsMax").val(),
						Hrs500MaxOptionFixed: $("#500HrsMaxOptionFixed").is(":checked"),
						Hrs500MaxOptionVariable: $("#500HrsMaxOptionVariable").is(":checked"),

						Hrs600Min: $("#600HrsMin").val(),
						Hrs600MinOptionFixed: $("#600HrsMinOptionFixed").is(":checked"),
						Hrs600MinOptionVariable: $("#600HrsMinOptionVariable").is(":checked"),
						Hrs600Max: $("#600HrsMax").val(),
						Hrs600MaxOptionFixed: $("#600HrsMaxOptionFixed").is(":checked"),
						Hrs600MaxOptionVariable: $("#600HrsMaxOptionVariable").is(":checked"),

						Trhrs: $("#trhrs").val(),
						Ohrs: $("#ohrs").val(),
						Grade: $("#grade").val()				
						}
						console.log(catalogFormObj);
						console.log(catalogRule["Degree Program"]);

						if(catalogFormObj.Hrs400Min != "" && catalogFormObj.Hrs400MinOptionFixed == false && catalogFormObj.Hrs400MinOptionVariable == false){
							alert("400HrsMin: Fixed or Variable?")
						}
						if(catalogFormObj.Hrs400Max != "" && catalogFormObj.Hrs400MaxOptionFixed == false && catalogFormObj.Hrs400MaxOptionVariable == false){
							alert("400HrsMax: Fixed or Variable?")
						}
						if(catalogFormObj.Hrs500Min != "" && catalogFormObj.Hrs500MinOptionFixed == false && catalogFormObj.Hrs500MinOptionVariable == false){
							alert("500HrsMin: Fixed or Variable?")
						}
						if(catalogFormObj.Hrs500Max != "" && catalogFormObj.Hrs500MaxOptionFixed == false && catalogFormObj.Hrs500MaxOptionVariable == false){
							alert("500HrsMax: Fixed or Variable?")
						}
						if(catalogFormObj.Hrs600Min != "" && catalogFormObj.Hrs600MinOptionFixed == false && catalogFormObj.Hrs600MinOptionVariable == false){
							alert("600HrsMin: Fixed or Variable?")
						}
						if(catalogFormObj.Hrs600Max != "" && catalogFormObj.Hrs600MaxOptionFixed == false && catalogFormObj.Hrs600MaxOptionVariable == false){
							alert("600HrsMax: Fixed or Variable?")
						}
						
						if((!catalogRule["Degree Program"].hours400 && catalogFormObj.Hrs400Min != "") || (catalogRule["Degree Program"].hours400 && !catalogRule["Degree Program"].hours400.minimum && catalogFormObj.Hrs400Min != "")  || (catalogRule["Degree Program"].hours400 && catalogRule["Degree Program"].hours400.minimum && catalogRule["Degree Program"].hours400.minimum.hours != catalogFormObj.Hrs400Min)){
							if(catalogFormObj.Hrs400MinOptionFixed == true){
								if(catalogFormObj.Hrs400Min < 1){
									alert("400HrsMin if Fixed cant be below 1")
								}			
							}else if(catalogFormObj.Hrs400MinOptionVariable == true){
								if(catalogFormObj.Hrs400Min > 1){
									alert("400HrsMin if Variable cant be above 1")
								}
							}		
							catalogFormChange.Hrs400Min = true;					
						}

						if((!catalogRule["Degree Program"].hours400 && catalogFormObj.Hrs400Max != "") || (catalogRule["Degree Program"].hours400 && !catalogRule["Degree Program"].hours400.maximum && catalogFormObj.Hrs400Max != "")  || (catalogRule["Degree Program"].hours400 && catalogRule["Degree Program"].hours400.maximum && catalogRule["Degree Program"].hours400.maximum.hours != catalogFormObj.Hrs400Max)){
							if(catalogFormObj.Hrs400MaxOptionFixed == true){
								if(catalogFormObj.Hrs400Max < 1){
									alert("400HrsMax if Fixed cant be below 1")
								}			
							}else if(catalogFormObj.Hrs400MaxOptionVariable == true){
								if(catalogFormObj.Hrs400Max > 1){
									alert("400HrsMax if Variable cant be above 1")
								}
							}		
							catalogFormChange.Hrs400Max = true;					
						}

						if((!catalogRule["Degree Program"].hours500 && catalogFormObj.Hrs500Min != "") || (catalogRule["Degree Program"].hours500 && !catalogRule["Degree Program"].hours500.minimum && catalogFormObj.Hrs500Min != "")  || (catalogRule["Degree Program"].hours500 && catalogRule["Degree Program"].hours500.minimum && catalogRule["Degree Program"].hours500.minimum.hours != catalogFormObj.Hrs500Min)){
							if(catalogFormObj.Hrs500MinOptionFixed == true){
								if(catalogFormObj.Hrs500Min < 1){
									alert("500HrsMin if Fixed cant be below 1")
								}			
							}else if(catalogFormObj.Hrs500MinOptionVariable == true){
								if(catalogFormObj.Hrs500Min > 1){
									alert("500HrsMin if Variable cant be above 1")
								}
							}		
							catalogFormChange.Hrs500Min = true;					
						}

						if((!catalogRule["Degree Program"].hours500 && catalogFormObj.Hrs500Max != "") || (catalogRule["Degree Program"].hours500 && !catalogRule["Degree Program"].hours500.maximum && catalogFormObj.Hrs500Max != "")  || (catalogRule["Degree Program"].hours500 && catalogRule["Degree Program"].hours500.maximum && catalogRule["Degree Program"].hours500.maximum.hours != catalogFormObj.Hrs500Max)){
							if(catalogFormObj.Hrs500MaxOptionFixed == true){
								if(catalogFormObj.Hrs500Max < 1){
									alert("500HrsMax if Fixed cant be below 1")
								}			
							}else if(catalogFormObj.Hrs500MaxOptionVariable == true){
								if(catalogFormObj.Hrs500Max > 1){
									alert("500HrsMax if Variable cant be above 1")
								}
							}		
							catalogFormChange.Hrs500Max = true;					
						}

						if((!catalogRule["Degree Program"].hours600 && catalogFormObj.Hrs600Min != "") || (catalogRule["Degree Program"].hours600 && !catalogRule["Degree Program"].hours600.minimum && catalogFormObj.Hrs600Min != "")  || (catalogRule["Degree Program"].hours600 && catalogRule["Degree Program"].hours600.minimum && catalogRule["Degree Program"].hours600.minimum.hours != catalogFormObj.Hrs600Min)){
							if(catalogFormObj.Hrs600MinOptionFixed == true){
								if(catalogFormObj.Hrs600Min < 1){
									alert("600HrsMin if Fixed cant be below 1")
								}			
							}else if(catalogFormObj.Hrs600MinOptionVariable == true){
								if(catalogFormObj.Hrs600Min > 1){
									alert("600HrsMin if Variable cant be above 1")
								}
							}		
							catalogFormChange.Hrs600Min = true;					
						}

						if((!catalogRule["Degree Program"].hours600 && catalogFormObj.Hrs600Max != "") || (catalogRule["Degree Program"].hours600 && !catalogRule["Degree Program"].hours600.maximum && catalogFormObj.Hrs600Max != "")  || (catalogRule["Degree Program"].hours600 && catalogRule["Degree Program"].hours600.maximum && catalogRule["Degree Program"].hours600.maximum.hours != catalogFormObj.Hrs600Max)){
							if(catalogFormObj.Hrs600MaxOptionFixed == true){
								if(catalogFormObj.Hrs600Max < 1){
									alert("600HrsMax if Fixed cant be below 1")
								}			
							}else if(catalogFormObj.Hrs600MaxOptionVariable == true){
								if(catalogFormObj.Hrs600Max > 1){
									alert("600HrsMax if Variable cant be above 1")
								}
							}		
							catalogFormChange.Hrs600Max = true;					
						}

						console.log(catalogFormChange);

						$.ajax({
						type: "POST",
						url: "../scripts/submitChange.php",
						data: {
						dataObj:catalogFormObj,
						dataObjChange:catalogFormChange,
						idObject: catalogRule["Degree Program"].id},
						dataType: "json",
						success: function(json) {
							console.log("Worked");
						},
						error: function(msg){
							console.log("Error");
						}
					});
						//TODO Finish checking ohrs and trhrs

				});
            });
            
			function addNewCatalog(catalogArray, catalogName) {
				processCatalog(catalogArray, catalogName);
				if(Object.keys($catalogs).length === 1) {
					$catalogs[catalogName].clone().insertAfter($("#classListLabel"));
					$catalogs[catalogName].clone().insertAfter($("#classListLabelOverrides"));
				}
				var $removeButton = $("<input>",{
					id: catalogName,
					type: "submit",
					name: "removeClassButton",
					value: "Remove"
				});
				$removeButton.click(removeCatalogHandler);
				$("#applicableCatalogsList").append($("<li>",{
					text: catalogName
				}).append($removeButton));
				$("#catalogList, #catalogListOverrides").append($("<option>",{
					value: catalogName,
					text: catalogName
				}));
			}
			
			// TODO modularize these event handlers into one
			function removeCatalogHandler() {
				
			}
			
			function removeOverrideHandler() {
				var courseId = $(this).attr("id");
				selectedOverrides = selectedOverrides.filter(function(id) {
					return id != courseId;
				});
				$(this).parent().remove();
			}
			
			function removeRequiredHandler() {
				var courseId = $(this).attr("id");
				requiredCourseIds = requiredCourseIds.filter(function(id) {
					return id != courseId;
				});
				$(this).parent().remove();
			}
			
			function removeMinorHandler() {
				var minorId = $(this).attr("id");
				selectedMinors = selectedMinors.filter(function(id) {
					return id != minorId;
				});
				$(this).parent().remove();
			}
			
			function removeCertificateHandler() {
				var certificateId = $(this).attr("id");
				selectedCertificates = selectedCertificates.filter(function(id) {
					return id != certificateId;
				});
				$(this).parent().remove();
			}
			
			function degreeHandlerInit() {
				degreeHandler(JSON.parse(this.response), true);
				
				var xhr = new XMLHttpRequest();
				xhr.addEventListener("load", nonDegreeHandlerInit);
				xhr.open("GET", "../scripts/nondegreeObjects.php");
				xhr.send();
			}
			
			function nonDegreeHandlerInit() {
				degreeHandler(JSON.parse(this.response), false);
				$("button[name='modifyButton']").click(function(){
					if(degreeProgramIds.includes($(this).val())) {
						$("#additionalOptionsContainer").show();
					} else {
						$("#additionalOptionsContainer").hide();
					}
					$.ajax({
						type: "POST",
						url: "../scripts/requirements.php",
						data: {idObjects: $(this).val()},
						dataType: "json",
						success: function(json) {
							popupHandler(json);
						}
					});
				});
				
				// Initialize page contents with select lists and add buttons
				for(var index in $objectSubjects) {
					$objectSubjects[index].change(function(){
						if($(this).val() === "newSubject") {
							$("#newObjectSubjectSpan").show();
						} else {
							$("#newObjectSubjectSpan").hide();
						}
					});
				}
				$objectSubjects[$("#newItemCategories option:selected").val()].insertAfter($("#objectSubjectLabel"));
				if($("#objectSubects option:selected").val() === "newSubject") {
					$("#newObjectSubjectSpan").show();
				}
				var $addItemButton = $("<button>", {
					name: "addNewItem",
					text: "Add New Item"
				});
				$addItemButton.click(function() {
					popupHandlerAddNewItem();
				});
				$("#listContainer").append($("<li>", {
					name: "addNewItem"
				}).append($addItemButton));
				
			}
			
			
			/**
			param: programs - Array of programs to process into the list. This will be done according to the subject of the program
			param: showEditCatalog - If true this will add the option to edit the catalog for any subjects
			*/
			function degreeHandler(programs, showEditCatalog) {
				var degreePrograms = programs;
				console.log(degreePrograms);
				var $degreeSubjects;
				var $degreeOptions;

				// Iterate through all degree programs (Masters,PhD,etc) and add to DOM
				for(var degreeName in degreePrograms) {
					$("#newItemCategories").append($("<option>", {
						value: degreeName,
						text: degreeName
					}));
					$("#listContainer").append($("<li>", {
						value: degreeName
					}).append($("<label>", {
						text: degreeName
					})));
					$("#listContainer").append($("<li>", {
						value: "globalRequirements"
					}).append($("<label>", {
						text: "Global Requirements"
					})).append($("<button>", {
						value: degreeName,
						name: "modifyGlobal",
						text: "Modify"
					})));
					
					var $subjects = $("<select>", {
						id: "objectSubjects"
					});

					// Create nested list under each degree program with the subject, e.g., Computer Science 
					$degreeSubjects = $("<ul id='subjectList'>");
					console.log(degreePrograms[degreeName]);
					for(var degreeSubject in degreePrograms[degreeName]) {
					
						$degreeSubjects.append($("<li>", {
							text: degreeSubject
						}));
						var $subjectOption = $("<option>", {
							value: degreeSubject,
							text: degreeSubject
						});
						$subjects.append($subjectOption);
						
						$degreeOptions = $("<ul id='optionList'>");
						
						if(showEditCatalog) {
							$degreeOptions.append($("<li>", {
								name: "catalog"
							}).append($("<a>", {
								href: "addremove.html",
								text: "Edit Course Catalog",
								onclick: "document.cookie = 'program=" + degreeSubject + "'"
							})));
						}
						
						for(var degreeOption in degreePrograms[degreeName][degreeSubject]) {
							$degreeOptions.append($("<li>", {
								value: degreeOption,
							}).append($("<label>", {
								text: degreeOption
							})).append($("<button>", {
								value: degreePrograms[degreeName][degreeSubject][degreeOption],
								name: "modifyButton",
								text: "Modify"	
							})));
							// Add the ID to the degreeProgram ID list. This will be used to display additional options if the object ID is a degree program
							if(degreeName === "Masters" || degreeName === "PhD") {
								if(!catalogNames.includes(degreeSubject)) {
									$("#applicableCatalogsSelect").append($subjectOption);
									catalogNames.push(degreeSubject);
								}
								degreeProgramIds.push(degreePrograms[degreeName][degreeSubject][degreeOption]);
							}
						} 
						$degreeSubjects.append($degreeOptions);
					}
					$subjects.append($("<option>", {
						value: "newSubject",
						text: "New Subject"
					}));
					$objectSubjects[degreeName] = $subjects;
					$("#listContainer").append($degreeSubjects);
				}
				
			}

			function popupHandlerAddNewItem() {
				var modal = document.getElementById('addNewItemModal');
				modal.style.display = "block";
			}
			
			function popupHandler(json){
				catalogRule = json;
				catalogsLoaded = 0;
				catalogs = null;
				$catalogs = {};
				$minorsSubjectSelect = {};
				$certificatesSubjectSelect = {};
				requiredCourseIds = [];
				selectedMinors = [];
				selectedCertificates = [];
				$("#deleteForm").attr("idobjects", catalogRule["Degree Program"].id);
				console.log(catalogRule);

				var modal = document.getElementById('myModal');
				modal.style.display = "block";
				$("#requiredHrs").val(catalogRule["Degree Program"].requiredHours);
				if(catalogRule["Degree Program"].hours400) {
					if(catalogRule["Degree Program"].hours400.minimum) {
						$("#400HrsMin").val(catalogRule["Degree Program"].hours400.minimum.hours);
						$("#400HrsMin").attr("oldvalue", catalogRule["Degree Program"].hours400.minimum.hours);
						$("input[name='400HrsMinOption']").val([catalogRule["Degree Program"].hours400.minimum.type]);
					}
					if(catalogRule["Degree Program"].hours400.maximum) {
						$("#400HrsMax").val(catalogRule["Degree Program"].hours400.maximum.hours);
						$("#400HrsMax").attr("oldvalue", catalogRule["Degree Program"].hours400.maximum.hours);
						$("input[name='400HrsMaxOption']").val([catalogRule["Degree Program"].hours400.maximum.type]);
					}
				}
				if(catalogRule["Degree Program"].hours500) {
					if(catalogRule["Degree Program"].hours500.minimum) {
						$("#500HrsMin").val(catalogRule["Degree Program"].hours500.minimum.hours);
						$("#500HrsMin").attr("oldvalue", catalogRule["Degree Program"].hours500.minimum.hours);
						$("input[name='500HrsMinOption']").val([catalogRule["Degree Program"].hours500.minimum.type]);
					}if(catalogRule["Degree Program"].hours500.maximum) {
						$("#500HrsMax").val(catalogRule["Degree Program"].hours500.maximum.hours);
						$("#500HrsMax").attr("oldvalue", catalogRule["Degree Program"].hours500.maximum.hours);
						$("input[name='500HrsMaxOption']").val([catalogRule["Degree Program"].hours500.maximum.type]);
					}
				}
				if(catalogRule["Degree Program"].hours600) {
					if(catalogRule["Degree Program"].hours600.minimum) {
						$("#600HrsMin").val(catalogRule["Degree Program"].hours600.minimum.hours);
						$("#600HrsMin").attr("oldvalue", catalogRule["Degree Program"].hours600.minimum.hours);
						$("input[name='600HrsMinOption']").val([catalogRule["Degree Program"].hours600.minimum.type]);
					}
					if(catalogRule["Degree Program"].hours600.maximum) {
						$("#600HrsMax").val(catalogRule["Degree Program"].hours600.maximum.hours);
						$("#600HrsMin").attr("oldvalue", catalogRule["Degree Program"].hours600.maximum.hours);
						$("input[name='600HrsMaxOption']").val([catalogRule["Degree Program"].hours600.maximum.type]);
					}
				}
				$("#trhrs").attr('value',catalogRule["Degree Program"].transferCredit);
				$("#ohrs").attr('value',catalogRule["Degree Program"].outsideCredit);
				$("#grade").attr('value',catalogRule["Degree Program"].minGrade);
				// Load in all the catalogs for the program. This is done before setting information like required courses because the catalog information needs
				// to be known in order to retireve the course information.
				selectedCatalogs = [];
				for(var i in catalogRule["Catalogs"]){
					let catalogName = catalogRule["Catalogs"][i];
					selectedCatalogs.push(catalogName);
					var $removeButton = $("<input>",{
						id: catalogName,
						type: "submit",
						name: "removeCatalogButton",
						value: "Remove"
					});
					$removeButton.click(removeCatalogHandler);
					$("#applicableCatalogsList").append($("<li>",{
						text: catalogName
					}).append($removeButton));
					$.ajax({
						type: "POST",
						url: "../scripts/courseCatalog.php",
						data: {catalogName: catalogName},
						dataType: "json",
						success: function(json) {
							courseHandler(json, catalogName);
						}
					});
				}
			}

			function attachCourseOverrideEntry(courseId, courseOverrideInfo) {
				var $removeButton = $("<input>",{
					id: courseId,
					type: "submit",
					name: "removeOverrideButton",
					value: "Remove"
				});
				$removeButton.click(removeOverrideHandler);
				$("#courseOverrideList").append($("<li>", {
					text: catalogs[courseId].name + " "
				}).append($("<label>", {
					for: "overrideCount" + courseId,
					text: "Maximum Times Countable"
				})).append($("<input>", {
					id: "overrideCount" + courseId,
					type: "number",
					value: courseOverrideInfo.maxCount,
					style: "width:50px"
				})).append($("<label>", {
					for: "overrideGrade" + courseId,
					text: "Minimum Grade"
				})).append($("<input>", {
					id: "overrideGrade" + courseId,
					type: "text",
					value: courseOverrideInfo.minGrade,
					maxlength: "2",
					pattern: "[ABCDF]{1}[-+]{0,1}",
					style: "width:50px"
				})).append($("<label>", {
					for: "overrideLowHours" + courseId,
					text: "Minium Hours"
				})).append($("<input>", {
					id: "overrideLowHours" + courseId,
					type: "number",
					value: courseOverrideInfo.minHours,
					style: "width:50px"
				})).append($("<label>", {
					for: "overrideHighHours" + courseId,
					text: "Maximum Hours"
				})).append($("<input>", {
					id: "overrideHighHours" + courseId,
					type: "number",
					value: courseOverrideInfo.maxHours,
					style: "width:50px"
				})).append($removeButton));
			}
			
			// This function will set any null entries in the override info to be the information in the catalog 
			function processOverrides(courseId, courseOverrideInfo) {
				if(!courseOverrideInfo.minGrade) {
					courseOverrideInfo.minGrade = catalogRule["Degree Program"].minGrade;
				}
				if(!courseOverrideInfo.maxCount) {
					courseOverrideInfo.maxCount = 1;
				}
				if(!courseOverrideInfo.minHours) {
					courseOverrideInfo.minHours = catalogs[courseId].lowHours;
				}
				if(!courseOverrideInfo.maxHours) {
					courseOverrideInfo.maxHours = catalogs[courseId].highHours;
				}
				return courseOverrideInfo;
			}
			
			function processCatalog(catalogArray, catalogName) {
				console.log("Processing catalog");
				if(!catalogs) {
					catalogs = catalogArray;
				} else {
				 	for(var i in catalogArray) {
						catalogs[i] = catalogArray[i];
					}
				}
				catalogsLoaded++;
			
				var $courseList = $("<select>", {
					id: "courseList"
				});
				for(var courseId in catalogArray) {
					$courseList.append($("<option>",{
						value: courseId,
						text: catalogArray[courseId].prefix + " " + catalogArray[courseId].number + " : " +  catalogArray[courseId].name
					}));
				}
				$catalogs[catalogName] = $courseList;
			}
			
			function courseHandler(catalogArray, catalogName){
				console.log(catalogArray);
				selectedOverrides = [];
				processCatalog(catalogArray, catalogName);
			
				// Load in options once all catalogs have been retrieved
				if(catalogsLoaded === catalogRule["Catalogs"].length) {
					
					//Iterate through catalog index with degreeID
					for(var i in catalogRule["Degree Program"].requiredCourses){
						requiredCourseIds.push(i);
						var $removeButton = $("<input>",{
							id: i,
							type: "submit",
							name: "removeClassButton",
							value: "Remove"
						});
						$removeButton.click(removeRequiredHandler);
						$("#classsublist").append($("<li>",{
							text: catalogs[i].name
						}).append($removeButton));
					}
					
					//Iterate through any course overrides and display information
					console.log(catalogRule["Degree Program"].courseOverride);
					for(var courseId in catalogRule["Degree Program"].courseOverride) {
						var courseOverrideInfo = catalogRule["Degree Program"].courseOverride[courseId];
						courseOverrideInfo = processOverrides(courseId, courseOverrideInfo);
						selectedOverrides.push(courseId);
						attachCourseOverrideEntry(courseId, courseOverrideInfo);
					}					

					// Set the contents of the required course select
					addClassHandler();
					// Load in the minors
					var xhr = new XMLHttpRequest();
					xhr.addEventListener("load", minorsHandler);
					xhr.open("GET", "../scripts/minors.php");
					xhr.send();
				
					for(var minorIndex in catalogRule["Minor"]) {
						selectedMinors.push(catalogRule["Minor"][minorIndex].id);
						var $removeButton = $("<input>", {
							id: catalogRule["Minor"][minorIndex].id,
							type: "submit",
							name: "removeClassButton",
							value: "Remove"
						});
						$removeButton.click(removeMinorHandler);
						$("#minorList").append($("<li>",{
							text: catalogRule["Minor"][minorIndex].name
						}).append($removeButton));
					}
					
					// Now load in the certificates
					
					var xhr = new XMLHttpRequest();
					xhr.addEventListener("load", certificateHandler);
					xhr.open("GET", "../scripts/certificates.php");
					xhr.send();
					
					for(var certificateIndex in catalogRule["Certificate"]) {
						selectedCertificates.push(catalogRule["Certificate"][certificateIndex].id);
						var $removeButton = $("<input>", {
							id: catalogRule["Certificate"][certificateIndex].id,
							type: "submit",
							name: "removeClassButton",
							value: "Remove"
						});
						$removeButton.click(removeCertificateHandler);
						$("#certificateList").append($("<li>",{
							text: catalogRule["Certificate"][certificateIndex].name
						}).append($removeButton));
					}
				}
			}

			function addClassHandler(){
				for(var i in catalogRule["Catalogs"]){
					$("#catalogList, #catalogListOverrides").append($("<option>",{
						value: catalogRule["Catalogs"][i],
						text: catalogRule["Catalogs"][i]
					}));
				}
				$catalogs[catalogRule["Catalogs"][0]].clone().insertAfter($("#classListLabel"));
				$catalogs[catalogRule["Catalogs"][0]].clone().insertAfter($("#classListLabelOverrides"));
			}
			
			function processList($globalList, $subjectList, idName, requirementList) {
				var $selectList;
				for(var objectId in requirementList) {
					// If there is no select list for the given subject then add a new option to the subject select list and create a new select list for that subject
					if(!$globalList[requirementList[objectId].subject]) {
						$subjectList.append($("<option>", {
							value: requirementList[objectId].subject,
							text: requirementList[objectId].subject
						}));
						$selectList = $("<select>", {
							id: idName
						});
						$globalList[requirementList[objectId].subject] = $selectList; // Add select list to array, key off subject
					}
					// Add the minor name to the select list belonging to that subject
					$globalList[requirementList[objectId].subject].append($("<option>", {
						value: objectId,
						text: requirementList[objectId].name
					}));
				}
			}
			
			// This will populate the select lists with minor information. There are two select lists: the list for the minor subjects and the list for the minors within that subject. 
			// The desired outcome of this code is to create select lists for each subject and add minors to those select lists when they belong to those subjects.
			function minorsHandler() {
				minors = JSON.parse(this.response);
				console.log(minors);
				var $minorSubjectList = $("#minorSubjectList");
				// Iterate through the minor list by minor id
				processList($minorsSubjectSelect, $minorSubjectList, "minorSelect", minors);
				// Initialize the minor select list shown to be the list for the selected option
				$minorsSubjectSelect[$("#minorSubjectList option:selected").val()].insertAfter($("#minorSelectLabel"));
			}
			
			
			function certificateHandler() {
				certificates = JSON.parse(this.response);
				console.log(certificates);
				var $certificateSubjectList = $("#certificateSubjectList");
				processList($certificatesSubjectSelect, $certificateSubjectList, "certificateSelect", certificates);
				// Initialize the minor select list shown to be the list for the selected option
				$certificatesSubjectSelect[$("#certificateSubjectList option:selected").val()].insertAfter($("#certificateSelectLabel")); 
			}
			
			function closeAddItem() {
				var modal = document.getElementById('addNewItemModal');
				modal.style.display = "none";	
			}
			
			function closepopup(){
				$("#certificateList").empty();
				$("#courseOverrideList").empty();
				$("#minorList").empty();
				$("#applicableCatalogsList").empty();
				$("#classsublist").empty();
				$("#popupform").children("input[type='number']").val("");
				$("#popupform").children("input[type='number']").attr("oldvalue", "");
				$("#popupform").children("input[type='radio']:checked").prop("checked", false);
				$("#minorSelect").detach();
				$("#minorSubjectList").empty();
				$("#certificateSelect").detach();
				$("#certificateSubjectList").empty();
				$("[id='courseList']").remove();
				$("#catalogList").empty();
				$("#catalogListOverrides").empty();
				$("#classsublist").empty();
				var modal = document.getElementById('myModal');
				modal.style.display = "none";	
			}
			
        </script>
        <style>

        </style>
    </head>
    <body>
        <div id="listContainer">

		</div>
		<div id="addNewItemModal" class="modal">
			<div class="modal-content">
				<span onclick="closeAddItem()" class="close">&times;</span>
				<div id="addNewItemContent">
					<label for="newItemCategories">Category :</label>
					<select id="newItemCategories">
				
					</select>
					<br>
					<label for="objectSubect" id="objectSubjectLabel">Subject :</label>
					<span id="newObjectSubjectSpan" hidden>
						<label for="newObjectSubject">Subject Name :</label>
						<input type="text" id="newObjectSubject"></input>
					</span>
					<br>
					<label for="newItemName">Name: </label>
					<input type="text" id="newItemName"></input>
					<br>
					<input type="button" id="addNewItemButton" value="Add"></input>
				</div>
			</div>
		</div>
		<div id="myModal" class="modal">
			<div class="modal-content">
			  <span onclick="closepopup()" class="close">&times;</span>
			  <div id="popupform">
					Required Hours: <input type="number" id="requiredHrs" style="width:50px">
					<br>
					400 Hours Minimum: <input type="number" id="400HrsMin" style="width:50px">
					<label for="400HrsMinOptionFixed">Fixed</label><input type="radio" id="400HrsMinOptionFixed" name="400HrsMinOption" value="fixed">
					<label for="400HrsMinOptionVariable">Variable</label><input type="radio" id="400HrsMinOptionVariable" name="400HrsMinOption" value="variable">
					<br>
					400 Hours Maximum: <input type="number" id="400HrsMax" style="width:50px">
					<label for="400HrsMaxOptionFixed">Fixed</label><input type="radio" id="400HrsMaxOptionFixed" name="400HrsMaxOption" value="fixed">
					<label for="400HrsMaxOptionVariable">Variable</label><input type="radio" id="400HrsMaxOptionVariable" name="400HrsMaxOption" value="variable">
					<br>
					500 Hours Minimum: <input type="number" id="500HrsMin" style="width:50px">
					<label for="500HrsMinOptionFixed">Fixed</label><input type="radio" id="500HrsMinOptionFixed" name="500HrsMinOption" value="fixed">
					<label for="500HrsMinOptionVariable">Variable</label><input type="radio" id="500HrsMinOptionVariable" name="500HrsMinOption" value="variable">
					<br>
					500 Hours Maximum: <input type="number" id="500HrsMax" style="width:50px">
					<label for="500HrsMaxOptionFixed">Fixed</label><input type="radio" id="500HrsMaxOptionFixed" name="500HrsMaxOption" value="fixed">
					<label for="500HrsMaxOptionVariable">Variable</label><input type="radio" id="500HrsMaxOptionVariable" name="500HrsMaxOption" value="variable">
					<br>
					600 Hours Minimum: <input type="number" id="600HrsMin" style="width:50px">
					<label for="600HrsMinOptionFixed">Fixed</label><input type="radio" id="600HrsMinOptionFixed" name="600HrsMinOption" value="fixed">
					<label for="600HrsMinOptionVariable">Variable</label><input type="radio" id="600HrsMinOptionVariable" name="600HrsMinOption" value="variable">
					<br>
					600 Hours Maximum: <input type="number" id="600HrsMax" style="width:50px">
					<label for="600HrsMaxOptionFixed">Fixed</label><input type="radio" id="600HrsMaxOptionFixed" name="600HrsMaxOption" value="fixed">
					<label for="600HrsMaxOptionVariable">Variable</label><input type="radio" id="600HrsMaxOptionVariable" name="600HrsMaxOption" value="variable">
					<br>
					Transfer Credit Hours: <input type="number" id="trhrs" style="width:50px">
					<br>
					Outside Credit Hours: <input type="number" id="ohrs" style="width:50px">
					<br>
					Minimum Grade: <input type="text" id="grade" style="width:50px">
			  </div>
			  <div id="applicableCatalogs">
				<h2>Applicable Catalogs</h2>
				<ul id="applicableCatalogsList">
				
				</ul>
				Catalog: <select id="applicableCatalogsSelect"></select><input type="button" id="addCatalogButton" value="Add Catalog"/>
			  </div>
			  <div id="requiredClasses">
				<h2>Required Courses</h2>
				<ul id="classsublist">

				</ul>
			  </div>
			  Catalog: <select id="catalogList"></select><label for="classList" id="classListLabel">Class:</label><input type="button" id="addClassButton" value="Add Class"/>
			  <div id="overridesContainer">
				<h2>Course Overrides</h2>
				<ul id="courseOverrideList">
			  
				</ul>
			  
				Catalog: <select id="catalogListOverrides"></select><label for="classList" id="classListLabelOverrides">Class:</label><input type="button" id="addClassButtonOverrides" value="Add Class"/>
			 </div>
			 <div id="additionalOptionsContainer" hidden>
				 <div id="minorContainer">
					<h2>Applicable Minors</h2>
					<ul id="minorList">
					
					</ul>
					Subject: <select id="minorSubjectList"></select><label for="minorSelect" id="minorSelectLabel">Minor:</label><input type="button" id="addMinorButton" value="Add Minor"/>
				  </div>
				  <div id="certificateContainer">
					<h2>Certificates</h2>
					<ul id="certificateList">
					
					</ul>
					Subject: <select id="certificateSubjectList"></select><label for="certificateSelect" id="certificateSelectLabel">Minor:</label><input type="button" id="addCertificateButton" value="Add Minor"/>
				  </div>
				  <br>
				  <input id="saveForm" type="submit" value="Save"></input>
				  <input id="deleteForm" type="button" value="Delete Program"></input>
				</div>
			</div>
		</div>
    </body>
</html>
